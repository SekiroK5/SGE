<div class="registro-container">
  <div class="registro-header">
    <h2>Registro de Empleados</h2>
    <p>Alta de nuevos empleados con generación automática de claves</p>
  </div>

  <div class="alert success" *ngIf="success">
    Empleado registrado exitosamente. Se ha generado una clave automática.
  </div>
  
  <div class="alert error" *ngIf="error">
    {{ error }}
  </div>

  <form [formGroup]="registroForm" (ngSubmit)="onSubmit()" class="registro-form">
    <!-- Información Personal -->
    <div class="section-header">
      <h3>Información Personal</h3>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="nombre">Nombre</label>
        <input type="text" id="nombre" formControlName="Nombre" 
               [ngClass]="{ 'invalid': submitted && f['Nombre'].errors }">
        <div class="error-message" *ngIf="submitted && f['Nombre'].errors">
          El nombre es requerido
        </div>
      </div>
      
      <div class="form-group">
        <label for="apellidoPaterno">Apellido Paterno</label>
        <input type="text" id="apellidoPaterno" formControlName="ApellidoPaterno"
               [ngClass]="{ 'invalid': submitted && f['ApellidoPaterno'].errors }">
        <div class="error-message" *ngIf="submitted && f['ApellidoPaterno'].errors">
          El apellido paterno es requerido
        </div>
      </div>

      <div class="form-group">
        <label for="apellidoMaterno">Apellido Materno</label>
        <input type="text" id="apellidoMaterno" formControlName="ApellidoMaterno"
               [ngClass]="{ 'invalid': submitted && f['ApellidoMaterno'].errors }">
        <div class="error-message" *ngIf="submitted && f['ApellidoMaterno'].errors">
          El apellido materno es requerido
        </div>
      </div>
    </div>

    <div class="form-row">
      
      
      <div class="form-group">
        <label for="fechaNacimiento">Fecha de Nacimiento</label>
        <input type="date" id="fechaNacimiento" formControlName="FechaNacimiento"
               [ngClass]="{ 'invalid': submitted && f['FechaNacimiento'].errors }">
        <div class="error-message" *ngIf="submitted && f['FechaNacimiento'].errors">
          La fecha de nacimiento es requerida
        </div>
      </div>

      <div class="form-group">
        <label for="sexo">Sexo</label>
        <select id="sexo" formControlName="Sexo"
                [ngClass]="{ 'invalid': submitted && f['Sexo'].errors }">
          <option value="">Seleccione</option>
          <option value="M">Masculino</option>
          <option value="F">Femenino</option>
        </select>
        <div class="error-message" *ngIf="submitted && f['Sexo'].errors">
          El sexo es requerido
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="foto">Foto (URL)</label>
        <input type="text" id="foto" formControlName="Foto">
      </div>
    </div>

    <!-- Dirección -->
    <div class="section-header">
      <h3>Dirección</h3>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="calle">Calle</label>
        <input type="text" id="calle" formControlName="Calle"
               [ngClass]="{ 'invalid': submitted && f['Calle'].errors }">
        <div class="error-message" *ngIf="submitted && f['Calle'].errors">
          La calle es requerida
        </div>
      </div>
      
      <div class="form-group">
        <label for="numeroExterior">Número Exterior</label>
        <input type="text" id="numeroExterior" formControlName="NumeroExterior"
               [ngClass]="{ 'invalid': submitted && f['NumeroExterior'].errors }">
        <div class="error-message" *ngIf="submitted && f['NumeroExterior'].errors">
          El número exterior es requerido
        </div>
      </div>

      <div class="form-group">
        <label for="numeroInterior">Número Interior</label>
        <input type="text" id="numeroInterior" formControlName="NumeroInterior">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="colonia">Colonia</label>
        <input type="text" id="colonia" formControlName="Colonia"
               [ngClass]="{ 'invalid': submitted && f['Colonia'].errors }">
        <div class="error-message" *ngIf="submitted && f['Colonia'].errors">
          La colonia es requerida
        </div>
      </div>
      
      <div class="form-group">
        <label for="codigoPostal">Código Postal</label>
        <input type="text" id="codigoPostal" formControlName="CodigoPostal"
               [ngClass]="{ 'invalid': submitted && f['CodigoPostal'].errors }">
        <div class="error-message" *ngIf="submitted && f['CodigoPostal'].errors">
          El código postal es requerido
        </div>
      </div>

      <div class="form-group">
        <label for="ciudad">Ciudad</label>
        <input type="text" id="ciudad" formControlName="Ciudad"
               [ngClass]="{ 'invalid': submitted && f['Ciudad'].errors }">
        <div class="error-message" *ngIf="submitted && f['Ciudad'].errors">
          La ciudad es requerida
        </div>
      </div>
    </div>

    <!-- Información Laboral -->
    <div class="section-header">
      <h3>Información Laboral</h3>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="departamento">Departamento</label>
        <select id="departamento" formControlName="Departamento"
                [ngClass]="{ 'invalid': submitted && f['Departamento'].errors }">
          <option value="">Seleccione un departamento</option>
          <option value="Recursos Humanos">Recursos Humanos</option>
          <option value="TI">TI</option>
          <option value="Finanzas">Finanzas</option>
          <option value="Marketing">Marketing</option>
          <option value="Ventas">Ventas</option>
          <option value="Operaciones">Operaciones</option>
        </select>
        <div class="error-message" *ngIf="submitted && f['Departamento'].errors">
          El departamento es requerido
        </div>
      </div>
      
      <div class="form-group">
        <label for="puesto">Puesto</label>
        <input type="text" id="puesto" formControlName="Puesto"
               [ngClass]="{ 'invalid': submitted && f['Puesto'].errors }">
        <div class="error-message" *ngIf="submitted && f['Puesto'].errors">
          El puesto es requerido
        </div>
      </div>
    </div>

    <!-- Contraseña -->
    <div class="form-row">
      <div class="form-group">
        <label for="password">Contraseña</label>
        <input type="password" id="password" formControlName="Password"
               [ngClass]="{ 'invalid': submitted && f['Password'].errors }">
        <div class="error-message" *ngIf="submitted && f['Password'].errors?.['required']">
          La contraseña es requerida
        </div>
        <div class="error-message" *ngIf="submitted && f['Password'].errors?.['minlength']">
          La contraseña debe tener al menos 6 caracteres
        </div>
      </div>
    </div>

    <!-- Teléfonos -->
    <div class="section-header">
      <h3>Teléfonos</h3>
      <button type="button" class="btn-add" (click)="agregarTelefono()">+ Agregar teléfono</button>
    </div>

    <div formArrayName="Telefonos">
      <div *ngFor="let telefono of telefonosArray.controls; let i = index" class="form-row" [formGroupName]="i">
        <div class="form-group">
          <label [for]="'lada' + i">Lada</label>
          <input type="text" [id]="'lada' + i" formControlName="Lada"
                 [ngClass]="{ 'invalid': submitted && telefono.get('Lada')?.errors }">
          <div class="error-message" *ngIf="submitted && telefono.get('Lada')?.errors">
            La lada es requerida
          </div>
        </div>
        
        <div class="form-group">
          <label [for]="'numero' + i">Número</label>
          <input type="text" [id]="'numero' + i" formControlName="Numero"
                 [ngClass]="{ 'invalid': submitted && telefono.get('Numero')?.errors }">
          <div class="error-message" *ngIf="submitted && telefono.get('Numero')?.errors">
            El número es requerido
          </div>
        </div>
        
        <button type="button" class="btn-remove" *ngIf="telefonosArray.length > 1" (click)="eliminarTelefono(i)">
          Eliminar
        </button>
      </div>
    </div>

    <!-- Correos Electrónicos -->
    <div class="section-header">
      <h3>Correos Electrónicos</h3>
      <button type="button" class="btn-add" (click)="agregarCorreo()">+ Agregar correo</button>
    </div>

    <div formArrayName="CorreoElectronico">
      <div *ngFor="let correo of correosArray.controls; let i = index" class="form-row" [formGroupName]="i">
        <div class="form-group">
          <label [for]="'direccion' + i">Dirección de correo</label>
          <input type="email" [id]="'direccion' + i" formControlName="Direccion"
                 [ngClass]="{ 'invalid': submitted && correo.get('Direccion')?.errors }">
          <div class="error-message" *ngIf="submitted && correo.get('Direccion')?.errors?.['required']">
            El correo electrónico es requerido
          </div>
          <div class="error-message" *ngIf="submitted && correo.get('Direccion')?.errors?.['email']">
            Ingrese un correo electrónico válido
          </div>
        </div>
        
        <button type="button" class="btn-remove" *ngIf="correosArray.length > 1" (click)="eliminarCorreo(i)">
          Eliminar
        </button>
      </div>
    </div>

    <!-- Referencias Familiares -->
    <div class="section-header">
      <h3>Referencias Familiares</h3>
      <button type="button" class="btn-add" (click)="agregarReferencia()">+ Agregar referencia</button>
    </div>

    <div formArrayName="ReferenciaFamiliar">
      <div *ngFor="let referencia of referenciasArray.controls; let i = index" class="form-group-container" [formGroupName]="i">
        <div class="form-row">
          <div class="form-group">
            <label [for]="'nombreRef' + i">Nombre completo</label>
            <input type="text" [id]="'nombreRef' + i" formControlName="NombreCompleto"
                   [ngClass]="{ 'invalid': submitted && referencia.get('NombreCompleto')?.errors }">
            <div class="error-message" *ngIf="submitted && referencia.get('NombreCompleto')?.errors">
              El nombre es requerido
            </div>
          </div>
          
          <div class="form-group">
            <label [for]="'parentesco' + i">Parentesco</label>
            <input type="text" [id]="'parentesco' + i" formControlName="Parentesco"
                   [ngClass]="{ 'invalid': submitted && referencia.get('Parentesco')?.errors }">
            <div class="error-message" *ngIf="submitted && referencia.get('Parentesco')?.errors">
              El parentesco es requerido
            </div>
          </div>
        </div>

        <!-- Teléfonos de referencia -->
        <div class="subsection">
          <h4>Teléfonos de contacto</h4>
          <button type="button" class="btn-add btn-add-small" (click)="agregarTelefonoReferencia(i)">+ Agregar teléfono</button>
          
          <div formArrayName="Telefono">
            <div *ngFor="let tel of getTelefonosReferencia(i).controls; let j = index" class="form-row" [formGroupName]="j">
              <div class="form-group">
                <label [for]="'refLada' + i + j">Lada</label>
                <input type="text" [id]="'refLada' + i + j" formControlName="Lada"
                       [ngClass]="{ 'invalid': submitted && tel.get('Lada')?.errors }">
                <div class="error-message" *ngIf="submitted && tel.get('Lada')?.errors">
                  La lada es requerida
                </div>
              </div>
              
              <div class="form-group">
                <label [for]="'refNumero' + i + j">Número</label>
                <input type="text" [id]="'refNumero' + i + j" formControlName="Numero"
                       [ngClass]="{ 'invalid': submitted && tel.get('Numero')?.errors }">
                <div class="error-message" *ngIf="submitted && tel.get('Numero')?.errors">
                  El número es requerido
                </div>
              </div>
              
              <button type="button" class="btn-remove" *ngIf="getTelefonosReferencia(i).length > 1" (click)="eliminarTelefonoReferencia(i, j)">
                Eliminar
              </button>
            </div>
          </div>
        </div>

        <!-- Correos de referencia -->
        <div class="subsection">
          <h4>Correos electrónicos</h4>
          <button type="button" class="btn-add btn-add-small" (click)="agregarCorreoReferencia(i)">+ Agregar correo</button>
          
          <div formArrayName="CorreoElectronico">
            <div *ngFor="let mail of getCorreosReferencia(i).controls; let j = index" class="form-row" [formGroupName]="j">
              <div class="form-group">
                <label [for]="'refCorreo' + i + j">Correo electrónico</label>
                <input type="email" [id]="'refCorreo' + i + j" formControlName="Direccion"
                       [ngClass]="{ 'invalid': submitted && mail.get('Direccion')?.errors }">
                <div class="error-message" *ngIf="submitted && mail.get('Direccion')?.errors?.['required']">
                  El correo electrónico es requerido
                </div>
                <div class="error-message" *ngIf="submitted && mail.get('Direccion')?.errors?.['email']">
                  Ingrese un correo electrónico válido
                </div>
              </div>
              
              <button type="button" class="btn-remove" *ngIf="getCorreosReferencia(i).length > 1" (click)="eliminarCorreoReferencia(i, j)">
                Eliminar
              </button>
            </div>
          </div>
        </div>
        
        <button type="button" class="btn-remove reference-remove" *ngIf="referenciasArray.length > 1" (click)="eliminarReferencia(i)">
          Eliminar referencia
        </button>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">Registrar Empleado</button>
      <button type="button" class="btn-secondary" (click)="cancelar()">Cancelar</button>
    </div>
  </form>
</div>